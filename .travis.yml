# To create a release

#   git checkout master
#   git pull
#   npm test
#   cd pkg; make docker && make docker-test && make docker-release
# Edit version in package.json to 1.0.0
#   npm run version
# The next command is only needed if tag already exists
#   git tag -d v1.0.0; git push --delete origin v1.0.0
#   git commit -a -m "Final 1.0.0 commit"
#   git push
# modify version number in package.json in master branch
#   git checkout deploy
#   git merge origin/master --squash
#   git commit -a -m "v1.0.0 Release"
#   git push
#   git checkout master
# Then manually trigger build of deploy branch at
# https://app.travis-ci.com/github/hapi-server/server-nodejs/ 

env:
  global:
    - npm_ver0=`cat package.json | grep version | head -1 | sed 's/^.*[^0-9]\([0-9]*\.[0-9]*\.[0-9]*\).*$/\1/'`
    - npm_ver=v`cat package.json | grep version | head -1 | sed 's/^.*[^0-9]\([0-9]*\.[0-9]*\.[0-9]*\).*$/\1/'`

before_install:
  - npm install
  - npm cache clean --force

script:
  - npm test

jobs:
  include:

    - stage: npm-deploy-test
      if: branch = deploy
      language: node_js
      node_js: "6.16"
      os: linux
      before_install: skip
      git:
        clone: false
      install: npm install -g "@hapi-server/server@1.0.4"
      branches:
        only:
          - deploy
      script: hapi-server --test


notifications:
  email:
    recipients:
      - ksreddy9945@gmail.com
      - rweigel@gmu.edu
  on_success: change
  on_failure: always
